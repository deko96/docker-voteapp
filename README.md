# Workshop Project — Docker Voting App

На овој проект наша задача ќе биде да креираме дистрибуирана апликација за гласање на претседателските избори 2020 во САД. Секој сегмент од апликацијата треба да биде издвоен и лесно скалабилен за да се осигураме дека апликацијата ќе биде во можност да ги опслужи ненадејните оптоварувања од гласови. За таа цел ќе користиме неколку сервиси изолирани во посебни контејнери, така што архитектурата ќе ни изгледа како на следната слика:

![Architecture Diagram](./data/architecture.png "Architecture")

## Vote container

Овој контејнер треба да е јавно достапен `http://localhost:5000` и треба да им овозможи на гласачите да гласаат. Ќе имам само еден _endpoint_ — `POST /vote` кој очекува _JSON payload_ со два елементи:
- `candidate` — еден од претседателските кандидати [`JB`, `DJT`]
- `state` — држава од каде се гласа [./data/states.json](./data/states.json)

Успешните гласови треба да се запишат во `redis` во листа `votes`.

Пример:
```
POST http://localhost:5000
{
    "candidate": "JB",
    "state": "AL"
}

...

> RPUSH votes {candidate::state::timestamp}
```

## Worker container

На одредени временски интервали (на пример секоја секунда) ги превзема гласовите запишани во `redis` и ги запишува во базата на податоци `db`. Ги брише обработените записи od `redis`. Не треба да е достапен јавно.

Пример:
```
> MULTI // изврши ги командите како трансакција
> LRANGE votes 0 -1 // земи ги сите гласови
> DEL votes
> EXEC

...

INSERT INTO votes ...
```

## Result container

Овој контејнер треба да е јавно достапен `http://localhost:5001` и треба да ѝ овозможи на јавноста да има преглед до резултатите т.е. да ги прикаже сумарните резултати — кој кандидат колку гласови освоил и сл.

```
GET http://localhost:5001

...

SELECT candidate, COUNT(id) AS count FROM votes GROUP BY candidate 
```

## Redis container

`redis` e _in-memory data store_ што го прави идеален избор за запишување на големи количини на податоци во единица време. Со овој контејнер ќе се осигураме дека ќе сме во можност да одговориме на сите гласови т.е. нема да пропуштиме ниту еден глас.

[Клиенти за `redis` за разни јазици](https://redis.io/clients)

## DB container

За овој контејнер може да користите база на податоци по сопствен избор. Всушност тука ќе имаме само една табела `votes` во која ќе ги запишуваме сите гласови. Пример за [postgres](./data/db.sql)